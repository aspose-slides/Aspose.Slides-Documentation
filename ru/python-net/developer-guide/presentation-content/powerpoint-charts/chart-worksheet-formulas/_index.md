---
title: "Применение формул листа диаграммы в презентациях с Python"
linktitle: "Формулы листа"
type: docs
weight: 70
url: /ru/python-net/chart-worksheet-formulas/
keywords:
- лист диаграммы
- рабочий лист диаграммы
- формула диаграммы
- формула листа
- формула таблицы
- источник данных
- логическая константа
- числовая константа
- строковая константа
- константа ошибки
- арифметическая константа
- оператор сравнения
- стиль A1
- стиль R1C1
- предопределённая функция
- PowerPoint
- OpenDocument
- презентация
- Python
- Aspose.Slides
description: "Применяйте формулы в стиле Excel в Aspose.Slides для Python через .NET листы диаграмм и автоматизируйте отчёты в файлах PPT, PPTX и ODP."
---

## **О формуле листа диаграммы в презентации**
**Лист диаграммы** (или рабочий лист диаграммы) в презентации является источником данных диаграммы. Лист диаграммы содержит данные, которые графически отображаются на диаграмме. При создании диаграммы в PowerPoint автоматически создаётся связанный с ней рабочий лист. Рабочий лист создаётся для всех типов диаграмм: линейная, столбчатая, sunburst, круговая и т.д. Чтобы увидеть лист диаграммы в PowerPoint, дважды щелкните по диаграмме:

![todo:image_alt_text](chart-worksheet-formulas_1.png)

Лист диаграммы содержит названия элементов диаграммы (Имя категории: *Category1*, Имя серии) и таблицу с числовыми данными, соответствующими этим категориям и сериям. По умолчанию при создании новой диаграммы данные листа диаграммы заполняются значениями по умолчанию. Затем вы можете изменить данные листа вручную.

Обычно диаграмма представляет сложные данные (например, финансовый или научный анализ), где ячейки вычисляются из значений других ячеек или из динамических данных. Ручное вычисление значения ячейки и жесткое его закрепление усложняет последующие изменения. При изменении значения определённой ячейки все зависящие от неё ячейки также требуют обновления. Более того, данные таблицы могут зависеть от данных других таблиц, образуя сложную схему данных презентации, которую необходимо легко и гибко обновлять.

**Формула листа диаграммы** в презентации — это выражение, автоматически вычисляющее и обновляющее данные листа диаграммы. Формула задаёт логику вычисления данных для конкретной ячейки или набора ячеек. Формула может быть математической или логической, используя ссылки на ячейки, математические функции, логические и арифметические операторы, функции преобразования, строковые константы и т.д. Определение формулы записывается в ячейку, и эта ячейка уже не содержит простое значение. Формула вычисляет значение и возвращает его, после чего значение присваивается ячейке. Формулы листов диаграмм в презентациях фактически такие же, как формулы Excel, и поддерживают те же стандартные функции, операторы и константы.

В [**Aspose.Slides**](https://products.aspose.com/slides/python-net/) лист диаграммы представлен свойством  
[**Chart.ChartData.ChartDataWorkbook**](https://reference.aspose.com/slides/python-net/aspose.slides.charts/ichartdata/) типа  
[**IChartDataWorkbook**](https://reference.aspose.com/slides/python-net/aspose.slides.charts/ichartdataworkbook/).  
Формула листа может быть назначена и изменена через свойство  
[**formula**](https://reference.aspose.com/slides/python-net/aspose.slides.charts/ichartdatacell/).  
Поддерживается следующая функциональность формул в Aspose.Slides:

- логические константы
- числовые константы
- строковые константы
- константы ошибок
- арифметические операторы
- операторы сравнения
- ссылки на ячейки в стиле A1
- ссылки на ячейки в стиле R1C1
- предопределённые функции

Обычно листы сохраняют последние вычисленные значения формул. Если после загрузки презентации данные диаграммы не изменялись, свойство **IChartDataCell.Value** возвращает эти значения при чтении. Но если данные листа изменились, при чтении свойства **ChartDataCell.Value** выбрасывается **CellUnsupportedDataException** для формул, которые не поддерживаются. Это происходит потому, что при успешном разборе формул определяются зависимости ячеек и корректность последних значений. Если формулу невозможно разобрать, корректность значения ячейки гарантировать нельзя.

## **Добавление формулы листа диаграммы в презентацию**
Сначала добавьте диаграмму с некоторыми образцовыми данными на первый слайд новой презентации с помощью  
[add_chart](https://reference.aspose.com/slides/python-net/aspose.slides/ishapecollection/).  
Лист диаграммы создаётся автоматически и к нему можно получить доступ через свойство  
[**chart_data_workbook**](https://reference.aspose.com/slides/python-net/aspose.slides.charts/ichartdata/):

```py
import aspose.slides.charts as charts
import aspose.slides as slides

with slides.Presentation() as presentation:
    chart = presentation.slides[0].shapes.add_chart(charts.ChartType.CLUSTERED_COLUMN, 150, 150, 500, 300)
    workbook = chart.chart_data.chart_data_workbook
    # ...
```

Запишем некоторые значения в ячейки через свойство  
[**value**](https://reference.aspose.com/slides/python-net/aspose.slides.charts/ichartdatacell/) типа **Object**, что позволяет задавать любое значение:

```py
    workbook.get_cell(0, "F2").value = -2.5
    workbook.get_cell(0, "G3").value = 6.3
    workbook.get_cell(0, "H4").value = 3
```

Теперь, чтобы записать формулу в ячейку, используйте свойство  
[**formula**](https://reference.aspose.com/slides/python-net/aspose.slides.charts/ichartdatacell/):

```py
    workbook.get_cell(0, "B2").formula = "F2+G3+H4+1"
```

*Примечание*: [**IChartDataCell.Formula**](https://reference.aspose.com/slides/python-net/aspose.slides.charts/ichartdatacell/) свойство используется для задания ссылок в стиле A1.

Чтобы задать ссылку в стиле R1C1, используйте свойство [**r1c1_formula**](https://reference.aspose.com/slides/python-net/aspose.slides.charts/ichartdatacell/):

```py
    workbook.get_cell(0, "C2").r1c1_formula = "R[1]C[4]/R[2]C[5]"
```

Затем вызовите метод [**calculate_formulas**](https://reference.aspose.com/slides/python-net/aspose.slides.charts/chartdataworkbook/) для вычисления всех формул в книге и обновления соответствующих значений ячеек:

```py
    workbook.calculate_formulas()
    print(workbook.get_cell(0, "B2").value) # 7.8
    print(workbook.get_cell(0, "C2").value) # 2.1
```

## **Логические константы**
Вы можете использовать логические константы, такие как *FALSE* и *TRUE*, в формулах ячеек:

## **Числовые константы**
Числа могут использоваться в обычной или научной нотации для создания формул листа диаграммы:

## **Строковые константы**
Строковая (литеральная) константа — это конкретное значение, используемое как есть и не меняющееся. Строковые константы могут быть: даты, тексты, числа и т.д.:

## **Константы ошибок**
Иногда результат формулы вычислить невозможно. В этом случае в ячейке вместо значения отображается код ошибки. Каждый тип ошибки имеет свой код:

- #DIV/0! — формула пытается выполнить деление на ноль.
- #GETTING_DATA — может отображаться в ячейке, пока её значение ещё вычисляется.
- #N/A — информация отсутствует или недоступна. Причины: пустые ячейки, лишний пробел, опечатка и т.п.
- #NAME? — нельзя найти ячейку или объект формулы по указанному имени.
- #NULL! — ошибка в формуле, например, неверно использованные запятые (,) или пробел вместо двоеточия (:).
- #NUM! — числовой аргумент формулы недопустим, слишком велик или мал.
- #REF! — недопустимая ссылка на ячейку.
- #VALUE! — неожиданный тип значения, например, строка в числовой ячейке.

## **Арифметические операторы**
Вы можете использовать все арифметические операторы в формулах листа диаграммы:

|**Оператор**|**Значение**|**Пример**|
| :- | :- | :- |
|+ (плюс)|Сложение или унарный плюс|2 + 3|
|- (минус)|Вычитание или отрицание|2 - 3<br>-3|
|* (звёздочка)|Умножение|2 * 3|
|/ (слеш)|Деление|2 / 3|
|% (процент)|Процент|30%|
|^ (карет)|Возведение в степень|2 ^ 3|

*Примечание*: Чтобы изменить порядок вычисления, заключите часть формулы в скобки.

## **Операторы сравнения**
Вы можете сравнивать значения ячеек с помощью операторов сравнения. Результатом является логическое значение *TRUE* или *FALSE*:

|**Оператор**|**Значение**|**Пример**|
| :- | :- | :- |
|= (равно)|Равно|A2 = 3|
|<> (не равно)|Не равно|A2 <> 3|
|> (больше)|Больше|A2 > 3|
|>= (больше или равно)|Больше или равно|A2 >= 3|
|< (меньше)|Меньше|A2 < 3|
|<= (меньше или равно)|Меньше или равно|A2 <= 3|

## **Ссылки на ячейки в стиле A1**
**Ссылки в стиле A1** используются, когда столбец обозначается буквой (например, "*A*"), а строка — цифрой (например, "*1*"). Пример использования:

|**Ссылка**|**Пример**|**Абсолютная**|**Относительная**|**Смешанная**|
| :- | :- | :- | :- | :- |
|Ячейка|$A$2|A2|<p>A$2</p><p>$A2</p>|
|Строка|$2:$2|2:2|-|
|Столбец|$A:$A|A:A|-|
|Диапазон|$A$2:$C$4|A2:C4|<p>$A$2:C4</p><p>A$2:$C4</p>|

## **Ссылки на ячейки в стиле R1C1**
**Ссылки в стиле R1C1** используются, когда и строка, и столбец обозначаются цифрами. Пример использования:

|**Ссылка**|**Пример**|**Абсолютная**|**Относительная**|**Смешанная**|
| :- | :- | :- | :- | :- |
|Ячейка|R2C3|R[2]C[3]|R2C[3]<br>R[2]C3|
|Строка|R2|R[2]|-|
|Столбец|C3|C[3]|-|
|Диапазон|R2C3:R5C7|R[2]C[3]:R[5]C[7]|R2C3:R[5]C[7]<br>R[2]C3:R5C[7]|

## **Предопределённые функции**
Существуют предопределённые функции, которые можно использовать в формулах для упрощения их реализации. Эти функции инкапсулируют наиболее часто используемые операции, такие как:

- ABS
- AVERAGE
- CEILING
- CHOOSE
- CONCAT
- CONCATENATE
- DATE (система дат 1900)
- DAYS
- FIND
- FINDB
- IF
- INDEX (форма ссылки)
- LOOKUP (векторная форма)
- MATCH (векторная форма)
- MAX
- SUM
- VLOOKUP

## **FAQ**

**Поддерживаются ли внешние файлы Excel в качестве источника данных для диаграммы с формулами?**

Да. Aspose.Slides поддерживает внешние книги как [источник данных диаграммы](https://reference.aspose.com/slides/python-net/aspose.slides.charts/chartdatasourcetype/), что позволяет использовать формулы из XLSX вне презентации.

**Могут ли формулы диаграммы ссылаться на листы в той же книге по имени листа?**

Да. Формулы следуют стандартной модели ссылок Excel, поэтому можно ссылаться на другие листы внутри той же книги или внешней книги. Для внешних ссылок указывайте путь и имя книги, используя синтаксис Excel.