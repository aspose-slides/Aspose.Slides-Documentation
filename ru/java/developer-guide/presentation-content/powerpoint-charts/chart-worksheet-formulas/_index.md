---
title: Применение формул листа данных диаграммы в презентациях с использованием Java
linktitle: Формулы листа
type: docs
weight: 70
url: /ru/java/chart-worksheet-formulas/
keywords:
- лист данных диаграммы
- лист диаграммы
- формула диаграммы
- формула листа
- формула таблицы
- источник данных
- логическая константа
- числовая константа
- строковая константа
- константа ошибки
- арифметическая константа
- оператор сравнения
- стиль A1
- стиль R1C1
- предопределённая функция
- PowerPoint
- презентация
- Java
- Aspose.Slides
description: "Применяйте формулы в стиле Excel в листах диаграмм Aspose.Slides for Java и автоматизируйте отчёты в файлах PPT и PPTX."
---

## **О формуле листа данных диаграммы в презентации**
**Лист данных диаграммы** (или лист диаграммы) в презентации является источником данных диаграммы. Лист данных диаграммы содержит данные, которые графически отображаются на диаграмме. При создании диаграммы в PowerPoint автоматически создаётся связанный с ней лист. Лист диаграммы создаётся для всех типов диаграмм: линейной, столбчатой, sunburst, круговой и т.д. Чтобы увидеть лист данных диаграммы в PowerPoint, щёлкните по диаграмме дважды:

![todo:image_alt_text](chart-worksheet-formulas_1.png)


Лист данных диаграммы содержит имена элементов диаграммы (Category Name: *Category1*, Serie Name) и таблицу с числовыми данными, соответствующими этим категориям и сериям. По умолчанию при создании новой диаграммы в листе данных задаются стандартные данные. Затем вы можете изменить данные листа вручную.

Обычно диаграмма представляет сложные данные (например, финансовые аналитики, научные аналитики), содержащие ячейки, вычисляемые из значений других ячеек или из динамических данных. Ручной ввод значения ячейки и «жёсткое» кодирование его в ячейку усложняет последующее изменение. При изменении значения определённой ячейки все зависимые от неё ячейки также потребуют обновления. Более того, данные таблицы могут зависеть от данных других таблиц, образуя сложную схему данных презентации, которую необходимо легко и гибко обновлять.

**Формула листа данных диаграммы** в презентации — это выражение для автоматического вычисления и обновления данных листа. Формула листа определяет логику расчёта данных для определённой ячейки или набора ячеек. Формула листа — это математическая или логическая формула, использующая ссылки на ячейки, математические функции, логические и арифметические операторы, функции преобразования, строковые константы и т.п. Определение формулы записывается в ячейку, и эта ячейка не содержит простого значения. Формула вычисляет значение и возвращает его, после чего значение присваивается ячейке. Формулы листа данных в презентациях фактически такие же, как формулы Excel, и поддерживают те же стандартные функции, операторы и константы.

В [**Aspose.Slides**](https://products.aspose.com/slides/java/) лист данных диаграммы представлен методом 
[**Chart.getChartData.getChartDataWorkbook**](https://reference.aspose.com/slides/java/com.aspose.slides/IChartData#getChartDataWorkbook--) типа 
[**IChartDataWorkbook**](https://reference.aspose.com/slides/java/com.aspose.slides/IChartDataWorkbook). 
Формула листа может быть установлена и изменена с помощью 
[**IChartDataCell.setFormula**](https://reference.aspose.com/slides/java/com.aspose.slides/IChartDataCell#setFormula-java.lang.String-) метода. 
Для формул в Aspose.Slides поддерживается следующая функциональность:

- Логические константы
- Числовые константы
- Строковые константы
- Константы ошибок
- Арифметические операторы
- Операторы сравнения
- Ссылки на ячейки в стиле A1
- Ссылки на ячейки в стиле R1C1
- Предопределённые функции


Как правило, листы сохраняют последние вычисленные значения формул. Если после загрузки презентации данные диаграммы не менялись, метод [**IChartDataCell.getValue**](https://reference.aspose.com/slides/java/com.aspose.slides/IChartDataCell#getValue--) возвращает эти значения при чтении. Но если данные листа были изменены, при чтении свойства **ChartDataCell.Value** генерируется исключение [**CellUnsupportedDataException**](https://reference.aspose.com/slides/java/com.aspose.slides/CellUnsupportedDataException) для неподдерживаемых формул. Это происходит потому, что при успешном разборе формул определяются зависимости ячеек и проверяется корректность последних значений. Если формула не может быть разобрана, корректность значения ячейки гарантировать нельзя.

## **Добавление формулы листа данных диаграммы в презентацию**
Сначала добавьте диаграмму на первый слайд новой презентации с помощью 
[IShapeCollection.getShapes.addChart](https://reference.aspose.com/slides/java/com.aspose.slides/IShapeCollection#addChart-int-float-float-float-float-). 
Лист диаграммы создаётся автоматически и к нему можно обратиться через 
[**Chart.getChartData.getChartDataWorkbook**](https://reference.aspose.com/slides/java/com.aspose.slides/IChartData#getChartDataWorkbook--) метод:
```java
Presentation pres = new Presentation();
try {
    IChart chart = pres.getSlides().get_Item(0).getShapes().addChart(ChartType.ClusteredColumn, 150, 150, 500, 300);

    IChartDataWorkbook workbook = chart.getChartData().getChartDataWorkbook();

    // ...
} finally {
    if (pres != null) pres.dispose();
}
```


Запишем некоторые значения в ячейки с помощью свойства 
[**IChartDataCell.setValue**](https://reference.aspose.com/slides/java/com.aspose.slides/IChartDataCell#setValue-java.lang.Object-) типа **Object**, что позволяет задавать любое значение:
```java
workbook.getCell(0, "F2").setValue(-2.5);

workbook.getCell(0, "G3").setValue(6.3);

workbook.getCell(0, "H4").setValue(3);
```


Чтобы записать формулу в ячейку, используйте метод 
[**IChartDataCell.setFormula**](https://reference.aspose.com/slides/java/com.aspose.slides/IChartDataCell#setFormula-java.lang.String-):

*Примечание*: Метод [**IChartDataCell.setFormula**](https://reference.aspose.com/slides/java/com.aspose.slides/IChartDataCell#setFormula-java.lang.String-) используется для установки ссылок в стиле A1. 

Чтобы задать ссылку в стиле [R1C1Formula](https://reference.aspose.com/slides/java/com.aspose.slides/IChartDataCell#getR1C1Formula--), используйте метод [**IChartDataCell.setR1C1Formula**](https://reference.aspose.com/slides/java/com.aspose.slides/IChartDataCell#setR1C1Formula-java.lang.String-):

Тогда при чтении значений ячеек B2 и C2 они будут вычислены:
```java
Object value1 = cell1.getValue(); // 7.8

Object value2 = cell2.getValue(); // 2.1
```


## **Логические константы**
В формулах ячеек можно использовать логические константы *FALSE* и *TRUE*:
```java
workbook.getCell(0, "A2").setValue(false);
IChartDataCell cell = workbook.getCell(0, "B2");
cell.setFormula("A2 = TRUE");
Object value = cell.getValue(); // значение содержит логическое "false"
```


## **Числовые константы**
В формулах листа диаграммы можно использовать числа в обычной или научной записи:
```java
workbook.getCell(0, "A2").setFormula("1 + 0.5");
workbook.getCell(0, "B2").setFormula(".3 * 1E-2");
```


## **Строковые константы**
Строковая (или литеральная) константа — это фиксированное значение, которое используется как есть и не меняется. Строковые константы могут быть датами, текстами, числами и т.п.:
```java
workbook.getCell(0, "A2").setFormula("\"abc\"");
workbook.getCell(0, "B2").setFormula("\"2/3/2020 12:00\"");
```


## **Константы ошибок**
Иногда результат формулы вычислить невозможно. В этом случае в ячейке показывается код ошибки вместо значения. Каждый тип ошибки имеет свой код:

- #DIV/0! - формула пытается делить на ноль.
- #GETTING_DATA - может отображаться в ячейке, пока её значение ещё вычисляется.
- #N/A - информация отсутствует или недоступна. Причины могут быть: пустые ячейки, лишний пробел, опечатка и т.д.
- #NAME? - не удалось найти ячейку или другой объект формулы по имени.
- #NULL! - возникает при ошибке в формуле, например : (,) или пробел вместо двоеточия (:).
- #NUM! - числовой аргумент формулы недопустим, слишком велик или слишком мал и т.п.
- #REF! - недопустимая ссылка на ячейку.
- #VALUE! - неожиданный тип значения. Например, строка в числовой ячейке.
```java
IChartDataCell cell = workbook.getCell(0, "A2");
cell.setFormula("2 / 0");
Object value = cell.getValue(); // значение содержит строку "#DIV/0!"
```


## **Арифметические операторы**
Во всех формулах листа диаграммы можно использовать следующие арифметические операторы:

|**Оператор**|**Значение**|**Пример**|
| :- | :- | :- |
|+ (плюс)|Сложение или унарный плюс|2 + 3|
|- (минус)|Вычитание или отрицание|2 - 3<br>-3|
|* (звёздочка)|Умножение|2 * 3|
|/ (слэш)|Деление|2 / 3|
|% (процент)|Процент|30%|
|^ (карет)|Возведение в степень|2 ^ 3|

*Примечание*: Чтобы изменить порядок вычисления, заключите нужную часть формулы в скобки.

## **Операторы сравнения**
С помощью операторов сравнения можно сравнивать значения ячеек. При их использовании результат — логическое значение *TRUE* или *FALSE*:

|**Оператор**|**Значение**|**Пример**|
| :- | :- | :- |
|= (равно)|Равно|A2 = 3|
|<> (не равно)|Не равно|A2 <> 3|
|> (больше)|Больше|A2 > 3|
|>= (больше или равно)|Больше или равно|A2 >= 3|
|< (меньше)|Меньше|A2 < 3|
|<= (меньше или равно)|Меньше или равно|A2 <= 3|

## **Ссылки на ячейки в стиле A1**
**Ссылки на ячейки в стиле A1** используются в листах, где столбец имеет буквенный идентификатор (например, "*A*"), а строка — числовой (например, "*1*"). Ссылки в стиле A1 применяются следующим образом:

|**Ссылка**|**Пример**|||
| :- | :- | :- | :- |
||Абсолютная|Относительная|Смешанная|
|Ячейка|$A$2|A2|<p>A$2</p><p>$A2</p>|
|Строка|$2:$2|2:2|‑|
|Столбец|$A:$A|A:A|‑|
|Диапазон|$A$2:$C$4|A2:C4|<p>$A$2:C4</p><p>A$2:$C4</p>|


Пример использования ссылки в стиле A1 в формуле:
```java
workbook.getCell(0, "A2").setFormula("C3 + SUM(F2:H5)");
```


## **Ссылки на ячейки в стиле R1C1**
**Ссылки на ячейки в стиле R1C1** используются в листах, где как строка, так и столбец имеют числовой идентификатор. Ссылки в стиле R1C1 применяются следующим образом:

|**Ссылка**|**Пример**|||
| :- | :- | :- | :- |
||Абсолютная|Относительная|Смешанная|
|Ячейка|R2C3|R[2]C[3]|R2C[3]<br>R[2]C3|
|Строка|R2|R[2]|‑|
|Столбец|C3|C[3]|‑|
|Диапазон|R2C3:R5C7|R[2]C[3]:R[5]C[7]|R2C3:R[5]C[7]<br>R[2]C3:R5C[7]|


Пример использования ссылки в стиле R1C1 в формуле:
```java
workbook.getCell(0, "A2").setR1C1Formula("R2C4 + SUM(R5C6:R7C9)");
```


## **Предопределённые функции**
Существует набор предопределённых функций, которые можно использовать в формулах для упрощения их реализации. Эти функции инкапсулируют наиболее часто используемые операции, такие как:

- ABS
- AVERAGE
- CEILING
- CHOOSE
- CONCAT
- CONCATENATE
- DATE (система дат 1900)
- DAYS
- FIND
- FINDB
- IF
- INDEX (форма ссылки)
- LOOKUP (векторная форма)
- MATCH (векторная форма)
- MAX
- SUM
- VLOOKUP

## **FAQ**

**Поддерживаются ли внешние файлы Excel в качестве источника данных для диаграммы с формулами?**

Да. Aspose.Slides поддерживает внешние книги как [источник данных диаграммы](https://reference.aspose.com/slides/java/com.aspose.slides/chartdatasourcetype/), что позволяет использовать формулы из XLSX вне презентации.

**Могут ли формулы диаграммы ссылаться на листы внутри той же книги по имени листа?**

Да. Формулы следуют стандартной модели ссылок Excel, поэтому вы можете ссылаться на другие листы в той же книге или во внешней книге. Для внешних ссылок указывайте путь и имя книги, используя синтаксис Excel.