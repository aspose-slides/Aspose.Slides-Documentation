---
title: Рабочее решение изменения размера диаграмм в PPTX
type: docs
weight: 60
url: /ru/net/working-solution-for-chart-resizing-in-pptx/
keywords:
- изменение размера диаграммы
- диаграмма Excel
- OLE‑объект
- встраивание диаграммы
- PowerPoint
- презентация
- .NET
- C#
- Aspose.Slides
description: "Исправьте неожиданное изменение размера диаграмм в PPTX при использовании встроенных Excel OLE‑объектов с Aspose.Slides для .NET. Узнайте два метода с кодом, чтобы сохранить размеры постоянными."
---

## **Предыстория**

Было замечено, что диаграммы Excel, встроенные в презентацию PowerPoint как OLE‑объекты через компоненты Aspose, после первого активации изменяют масштаб до неопределённого значения. Это приводит к заметной визуальной разнице между состоянием диаграммы до и после активации. Команда Aspose подробно изучила проблему и нашла решение. В этой статье описаны причины возникновения проблемы и соответствующее исправление.

В [предыдущей статье](/slides/ru/net/creating-excel-chart-and-embedding-it-in-presentation-as-ole-object/) мы показали, как создать диаграмму Excel с помощью Aspose.Cells для .NET и встроить её в презентацию PowerPoint с помощью Aspose.Slides для .NET. Чтобы решить [проблему предварительного просмотра объекта](/slides/ru/net/object-preview-issue-when-adding-oleobjectframe/), мы присвоили изображение диаграммы объекту OLE‑кадра. В результирующей презентации при двойном щелчке по OLE‑кадру, отображающему изображение диаграммы, активируется диаграмма Excel. Пользователи могут вносить любые изменения в исходную книгу Excel, а затем вернуться к соответствующему слайду, щёлкнув за пределами активированной книги. Размер OLE‑кадра меняется при возвращении к слайду, и коэффициент изменения зависит от исходных размеров как OLE‑кадра, так и вложенной книги Excel.

## **Причина изменения размера**

Поскольку у книги Excel собственный размер окна, при первой активации она пытается сохранить свой оригинальный размер. OLE‑кадр, однако, имеет свой размер. По данным Microsoft, при активации книги Excel происходит согласование размеров между Excel и PowerPoint, чтобы сохранить правильные пропорции в процессе встраивания. В зависимости от различий между размером окна Excel и размером или положением OLE‑кадра происходит изменение размеров.

## **Рабочее решение**

Существует два возможных сценария создания презентаций PowerPoint с помощью Aspose.Slides для .NET.

**Сценарий 1:** Создание презентации на основе существующего шаблона.

**Сценарий 2:** Создание презентации с нуля.

Предлагаемое решение применимо к обоим сценариям. Основная идея всех подходов одинакова: **размер окна вложенного OLE‑объекта должен соответствовать размеру OLE‑кадра на слайде PowerPoint**. Далее рассматриваются два подхода к реализации этого решения.

## **Первый подход**

В этом подходе мы узнаем, как установить размер окна вложенной книги Excel так, чтобы он совпадал с размером OLE‑кадра на слайде PowerPoint.

**Сценарий 1**

Предположим, что у нас есть шаблон, и мы хотим создавать презентации на его основе. В шаблоне есть фигура с индексом 2, в которой нужно разместить OLE‑кадр с вложенной книгой Excel. В этом сценарии размер OLE‑кадра предопределён — он совпадает с размером фигуры с индексом 2 в шаблоне. Всё, что нам нужно сделать, – установить размер окна книги Excel равным размеру этой фигуры. Ниже приведён фрагмент кода, выполняющий эту задачу:
```cs
// Определить размер диаграммы с окном. 
chart.SizeWithWindow = true;

// Установить ширину окна книги в дюймах (делить на 72, так как PowerPoint использует 72 пикселя на дюйм).
workbook.Worksheets.WindowWidthInch = slide.Shapes[2].Width / 72f;

// Установить высоту окна книги в дюймах.
workbook.Worksheets.WindowHeightInch = slide.Shapes[2].Height / 72f;

// Save the workbook to a memory stream.
MemoryStream workbookStream = workbook.SaveToStream();

// Create an OLE object frame with the embedded Excel data.
Aspose.Slides.OleObjectFrame oleFrame = slide.Shapes.AddOleObjectFrame(
    slide.Shapes[2].X,
    slide.Shapes[2].Y,
    slide.Shapes[2].Width,
    slide.Shapes[2].Height,
	"Excel.Sheet.8",
	workbookStream.ToArray());
```


**Сценарий 2**

Допустим, мы хотим создать презентацию с нуля и добавить OLE‑кадр произвольного размера с вложенной книгой Excel. В следующем фрагменте кода мы создаём OLE‑кадр высотой 4 дюйма и шириной 9,5 дюйма, расположенный на слайде в позиции x = 0,5 дюйма, y = 1 дюйм. Затем мы задаём окну книги Excel тот же размер — 4 дюйма в высоту и 9,5 дюйма в ширину.
```cs
// Желаемая высота.
int desiredHeight = 288; // 4 дюйма (4 * 72)

// Желаемая ширина.
int desiredWidth = 684;//9.5 дюйма (9.5 * 72)

// Определить размер диаграммы с окном.
chart.SizeWithWindow = true;

// Установить ширину окна книги в дюймах.
workbook.Worksheets.WindowWidthInch = desiredWidth / 72f;

// Установить высоту окна книги в дюймах.
workbook.Worksheets.WindowHeightInch = desiredHeight / 72f;

// Сохранить книгу в поток памяти.
MemoryStream workbookStream = workbook.SaveToStream();

// Создать OLE‑объектный кадр с вложенными данными Excel.
Aspose.Slides.OleObjectFrame oleFrame = slide.Shapes.AddOleObjectFrame(
    36,
    72,
    desiredWidth,
    desiredHeight,
	"Excel.Sheet.8",
	workbookStream.ToArray());
```


## **Второй подход**

В этом подходе мы узнаем, как установить размер диаграммы во вложенной книге Excel так, чтобы он совпадал с размером OLE‑кадра на слайде PowerPoint. Этот подход полезен, когда размер диаграммы известен заранее и не будет изменяться.

**Сценарий 1**

Предположим, что у нас есть шаблон, и мы хотим создавать презентации на его основе. В шаблоне есть фигура с индексом 2, в которой мы планируем разместить OLE‑кадр с вложенной книгой Excel. В этом сценарии размер OLE‑кадра предопределён — он совпадает с размером фигуры с индексом 2 в шаблоне. Всё, что нам нужно сделать, – установить размер диаграммы в книге, равным размеру этой фигуры. Ниже приведён соответствующий фрагмент кода:
```cs
// Определить размер диаграммы без окна. 
chart.SizeWithWindow = false;

// Установить ширину диаграммы в пикселях (умножить на 96, так как Excel использует 96 пикселей на дюйм).    
chart.ChartObject.Width = (int)((slide.Shapes[2].Width / 72f) * 96f);

// Установить высоту диаграммы в пикселях.
chart.ChartObject.Height = (int)((slide.Shapes[2].Height / 72f) * 96f);

// Определить размер печати диаграммы.
chart.PrintSize = PrintSizeType.Custom;

// Сохранить книгу в поток памяти.
MemoryStream workbookStream = workbook.SaveToStream();

// Создать OLE‑кадр объекта с вложенными данными Excel.
Aspose.Slides.OleObjectFrame oleFrame = slide.Shapes.AddOleObjectFrame(
    slide.Shapes[2].X,
    slide.Shapes[2].Y,
    slide.Shapes[2].Width,
    slide.Shapes[2].Height,
	"Excel.Sheet.8",
	workbookStream.ToArray());
```


**Сценарий 2**

Предположим, что мы хотим создать презентацию с нуля и добавить OLE‑кадр произвольного размера с вложенной книгой Excel. В следующем фрагменте кода мы создаём OLE‑кадр высотой 4 дюйма и шириной 9,5 дюйма, расположенный на слайде в позиции x = 0,5 дюйма, y = 1 дюйм. Мы также задаём размер соответствующей диаграммы теми же параметрами: высота 4 дюйма и ширина 9,5 дюйма.
```cs
 // Желаемая высота.
int desiredHeight = 288; // 4 дюйма (4 * 576)

// Желаемая ширина.
int desiredWidth = 684; // 9.5 дюйма (9.5 * 576)

// Определить размер диаграммы без окна. 
chart.SizeWithWindow = false;

// Установить ширину диаграммы в пикселях.   
chart.ChartObject.Width = (int)((desiredWidth / 72f) * 96f);

// Установить высоту диаграммы в пикселях.    
chart.ChartObject.Height = (int)((desiredHeight / 72f) * 96f);

// Сохранить книгу в поток памяти.
MemoryStream workbookStream = workbook.SaveToStream();

// Создать OLE‑кадр объекта с вложенными данными Excel.
Aspose.Slides.OleObjectFrame oleFrame = slide.Shapes.AddOleObjectFrame(
    36,
    72,
    desiredWidth,
    desiredHeight,
	"Excel.Sheet.8",
	workbookStream.ToArray());
```


## **Заключение**

Существует два подхода к устранению проблемы изменения размера диаграммы. Выбор подхода зависит от требований и сценария использования. Оба подхода работают одинаково как при создании презентаций из шаблона, так и при создании их с нуля. Кроме того, в этом решении нет ограничений по размеру OLE‑кадра.

## FAQ

**В:** Почему моя вложенная диаграмма Excel меняет размер после её активации в PowerPoint?  
Это происходит потому, что Excel пытается восстановить оригинальный размер окна при первой активации, тогда как OLE‑кадр в PowerPoint имеет свои собственные размеры. PowerPoint и Excel согласовывают размер, чтобы сохранить соотношение сторон, что может вызвать изменение размера.

**В:** Можно ли полностью предотвратить эту проблему с изменением размера?  
Да. Если предварительно согласовать размер окна книги Excel или размер диаграммы с размером OLE‑кадра, размеры диаграмм останутся постоянными.

**В:** Какой подход выбирать: установить размер окна книги или размер диаграммы?  
Используйте **Подход 1 (размер окна)**, если нужно сохранить пропорции книги и возможно позже изменить её размер.  
Используйте **Подход 2 (размер диаграммы)**, если размеры диаграммы фиксированы и не изменятся после встраивания.

**В:** Будут ли эти методы работать как с шаблонными, так и с новыми презентациями?  
Да. Оба подхода одинаково работают для презентаций, созданных из шаблонов, и для презентаций, созданных с нуля.

**В:** Существует ли ограничение размера OLE‑кадра?  
Нет. Вы можете задать любой размер OLE‑кадра, пока он адекватно масштабируется к размеру книги или диаграммы.

**В:** Можно ли использовать эти методы с диаграммами, созданными в других табличных программах?  
Примеры рассчитаны на диаграммы Excel, созданные с помощью Aspose.Cells, но принципы применимы к другим OLE‑совместимым табличным программам, если они поддерживают аналогичные параметры размера.

## **Связанные разделы**

- [Создание диаграмм Excel и их встраивание как OLE‑объекты в презентации](/slides/ru/net/creating-excel-chart-and-embedding-it-in-presentation-as-ole-object/)
- [Автоматическое обновление OLE‑объектов с помощью надстройки PowerPoint](/slides/ru/net/updating-ole-objects-automatically-using-ms-powerpoint-add-in/)