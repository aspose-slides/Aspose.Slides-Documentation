---
title: Формулы листа диаграммы
type: docs
weight: 70
url: /ru/net/chart-worksheet-formulas/
keywords: "Электронная таблица диаграммы, формула диаграммы, презентация PowerPoint, C#, Csharp, Aspose.Slides для .NET"
description: "Электронная таблица диаграммы и формула в презентации PowerPoint на C# или .NET"
---

## **О формуле электронной таблицы диаграммы в презентации**
**Chart spreadsheet** (или chart worksheet) в презентации является источником данных диаграммы. Chart spreadsheet содержит данные, которые отображаются на диаграмме графически. При создании диаграммы в PowerPoint автоматически создаётся лист, связанный с этой диаграммой. Лист создаётся для всех типов диаграмм: линейных, столбчатых, sunburst, круговых и т.д. Чтобы увидеть электронную таблицу диаграммы в PowerPoint, дважды щёлкните по диаграмме:

![todo:image_alt_text](chart-worksheet-formulas_1.png)



Chart spreadsheet содержит имена элементов диаграммы (Category Name: *Category1*, Serie Name) и таблицу с числовыми данными, соответствующими этим категориям и сериям. По умолчанию, когда вы создаёте новую диаграмму, в электронную таблицу диаграммы заносятся данные по умолчанию. Затем вы можете изменить данные листа вручную.

Обычно диаграмма представляет сложные данные (например, финансовый или научный анализ), имея ячейки, вычисленные из значений других ячеек или из динамических данных. Ручной ввод значения в ячейку и его «жёсткое» кодирование затрудняет последующие изменения. Если изменить значение определённой ячейки, все ячейки, зависящие от неё, также потребуют обновления. Кроме того, данные таблицы могут зависеть от данных других таблиц, создавая сложную схему данных презентации, которую необходимо легко и гибко обновлять.

**Chart spreadsheet formula** в презентации — это выражение для автоматического вычисления и обновления данных электронной таблицы диаграммы. Формула электронной таблицы определяет логику вычисления данных для отдельной ячейки или набора ячеек. Формула может быть математической или логической, использующей ссылки на ячейки, математические функции, логические и арифметические операторы, функции преобразования, строковые константы и т.д. Определение формулы записывается в ячейку, и эта ячейка не содержит простого значения. Формула вычисляет значение и возвращает его, после чего значение присваивается ячейке. Формулы электронной таблицы в презентациях по‑сути такие же, как формулы Excel, и поддерживают те же стандартные функции, операторы и константы.

В [**Aspose.Slides**](https://products.aspose.com/slides/net/) электронная таблица диаграммы представлена свойством 
[**Chart.ChartData.ChartDataWorkbook**](https://reference.aspose.com/slides/net/aspose.slides.charts/ichartdata/properties/chartdataworkbook) типа 
[**IChartDataWorkbook**](https://reference.aspose.com/slides/net/aspose.slides.charts/ichartdataworkbook). 
Формула электронной таблицы может быть назначена и изменена через свойство 
[**IChartDataCell.Formula**](https://reference.aspose.com/slides/net/aspose.slides.charts/ichartdatacell/properties/formula). 
В Aspose.Slides поддерживается следующая функциональность формул:

- Логические константы
- Числовые константы
- Строковые константы
- Константы ошибок
- Арифметические операторы
- Операторы сравнения
- Ссылки на ячейки в стиле A1
- Ссылки на ячейки в стиле R1C1
- Предопределённые функции



Обычно электронные таблицы хранят последние вычисленные значения формул. Если после загрузки презентации данные диаграммы не изменялись, свойство **IChartDataCell.Value** возвращает эти значения при чтении. Но если данные таблицы были изменены, при чтении свойства **ChartDataCell.Value** выбрасывается **CellUnsupportedDataException** для неподдерживаемых формул. Это происходит потому, что при успешном разборе формул определяются зависимости ячеек и проверяется корректность последних значений. Если формула не может быть разобрана, корректность значения ячейки гарантировать нельзя.
## **Добавление формулы электронной таблицы диаграммы в презентацию**
Сначала добавьте диаграмму с примерными данными на первый слайд новой презентации с помощью 
[IShapeCollection.Shapes.AddChart](https://reference.aspose.com/slides/net/aspose.slides.ishapecollection/addchart/methods/1). 
Лист диаграммы создаётся автоматически и к нему можно получить доступ через свойство 
[**Chart.ChartData.ChartDataWorkbook**](https://reference.aspose.com/slides/net/aspose.slides.charts/ichartdata/properties/chartdataworkbook):
``` csharp

using (var presentation = new Presentation())

{

    IChart chart = presentation.Slides[0].Shapes.AddChart(ChartType.ClusteredColumn, 150, 150, 500, 300);

    IChartDataWorkbook workbook = chart.ChartData.ChartDataWorkbook;

    // ...

}

```




Запишем некоторые значения в ячейки с помощью свойства 
[**IChartDataCell.Value**](https://reference.aspose.com/slides/net/aspose.slides.charts/ichartdatacell/properties/value) типа **Object**, что позволяет установить любое значение:
``` csharp

workbook.GetCell(0, "F2").Value = -2.5;

workbook.GetCell(0, "G3").Value = 6.3;

workbook.GetCell(0, "H4").Value = 3;

```




Теперь, чтобы записать формулу в ячейку, используйте свойство 
[**IChartDataCell.Formula**](https://reference.aspose.com/slides/net/aspose.slides.charts/ichartdatacell/properties/formula):
``` csharp
workbook.GetCell(0, "B2").Formula = "F2+G3+H4+1";
```


*Note*: [**IChartDataCell.Formula**](https://reference.aspose.com/slides/net/aspose.slides.charts/ichartdatacell/properties/formula) используется для задания ссылок на ячейки в стиле A1. 



Чтобы задать ссылку на ячейку в стиле R1C1, используйте свойство 
[**IChartDataCell.R1C1Formula**](https://reference.aspose.com/slides/net/aspose.slides.charts/ichartdatacell/properties/r1c1formula):
``` csharp
workbook.GetCell(0, "C2").R1C1Formula = "R[1]C[4]/R[2]C[5]";
```


Затем вызовите метод 
[**IChartDataWorkbook.CalculateFormulas**](https://reference.aspose.com/slides/net/aspose.slides.charts/chartdataworkbook/methods/calculateformulas), чтобы вычислить все формулы в рабочей книге и обновить соответствующие значения ячеек:
``` csharp
workbook.CalculateFormulas();

object value1 = workbook.GetCell(0, "B2"); // 7.8

object value2 = workbook.GetCell(0, "C2"); // 2.1

```



## **Логические константы**
Вы можете использовать логические константы, такие как *FALSE* и *TRUE*, в формулах ячеек:




## **Числовые константы**
Числа могут использоваться в обычной или научной нотации для создания формул электронной таблицы диаграммы:




## **Строковые константы**
Строковая (или буквальная) константа — это конкретное значение, которое используется «как есть» и не меняется. Строковые константы могут представлять даты, тексты, числа и т.д.:




## **Константы ошибок**
Иногда результат формулы невозможно вычислить. В этом случае в ячейке вместо значения отображается код ошибки. Каждая ошибка имеет свой код:

- #DIV/0! — формула пытается выполнить деление на ноль.
- #GETTING_DATA — может появиться в ячейке, пока её значение ещё вычисляется.
- #N/A — информация отсутствует или недоступна. Причины могут быть: пустые ячейки, лишний пробел, опечатка и т.п.
- #NAME? — не найден объект (ячейка или другая формула) по указанному имени. 
- #NULL! — может появиться при ошибке в формуле, например:  (,) или пробел вместо двоеточия (:).
- #NUM! — числовой аргумент формулы недопустим, слишком велик или слишком мал и т.п.
- #REF! — недопустимая ссылка на ячейку.
- #VALUE! — неожиданный тип значения. Например, строковое значение в числовой ячейке.




## **Арифметические операторы**
Вы можете использовать все арифметические операторы в формулах листа диаграммы:

|**Оператор** |**Значение** |**Пример**|
| :- | :- | :- |
|+ (плюс) |Сложение или унарный плюс|2 + 3|
|- (минус) |Вычитание или отрицание |2 - 3<br>-3|
|* (звёздочка)|Умножение |2 * 3|
|/ (слеш)|Деление |2 / 3|
|% (процент)|Процент |30%|
|^ (карет)|Возведение в степень |2 ^ 3|

*Note*: Чтобы изменить порядок вычисления, заключите в скобки часть формулы, которую нужно вычислить первой.


## **Операторы сравнения**
Вы можете сравнивать значения ячеек с помощью операторов сравнения. При их использовании результатом является логическое значение *TRUE* или *FALSE*:

|**Оператор** |**Значение** |**Пример**|
| :- | :- | :- |
|= (равно) |Равно |A2 = 3|
|<> (не равно) |Не равно|A2 <> 3|
|> (больше) |Больше чем|A2 > 3|
|>= (больше или равно) |Больше или равно|A2 >= 3|
|< (меньше) |Меньше чем|A2 < 3|
|<= (меньше или равно) |Меньше или равно|A2 <= 3|

## **Ссылки на ячейки в стиле A1**
**Ссылки на ячейки в стиле A1** используются в листах, где столбец имеет буквенный идентификатор (например, "*A*"), а строка — числовой (например, "*1*"). Ссылки могут применяться следующим образом:

|**Ссылка**|**Пример**|||
| :- | :- | :- | :- |
||Абсолютная |Относительная |Смешанная|
|Ячейка |$A$2 |A2|<p>A$2</p><p>$A2</p>|
|Строка |$2:$2 |2:2 |-|
|Столбец |$A:$A |A:A |-|
|Диапазон |$A$2:$C$4 |A2:C4|<p>$A$2:C4</p><p>A$2:$C4</p>|

Пример использования ссылки в стиле A1 в формуле:




## **Ссылки на ячейки в стиле R1C1**
**Ссылки на ячейки в стиле R1C1** используются в листах, где и строки, и столбцы имеют числовой идентификатор. Ссылки могут применяться следующим образом:

|**Ссылка**|**Пример**|||
| :- | :- | :- | :- |
||Абсолютная |Относительная |Смешанная|
|Ячейка |R2C3|R[2]C[3]|R2C[3]<br>R[2]C3|
|Строка |R2|R[2]|-|
|Столбец |C3|C[3]|-|
|Диапазон |R2C3:R5C7|R[2]C[3]:R[5]C[7] |R2C3:R[5]C[7]<br>R[2]C3:R5C[7]|

Пример использования ссылки в стиле R1C1 в формуле:




## **Предопределённые функции**
Существует набор предопределённых функций, которые могут использоваться в формулах для упрощения их реализации. Эти функции инкапсулируют наиболее часто используемые операции, такие как:

- ABS
- AVERAGE
- CEILING
- CHOOSE
- CONCAT
- CONCATENATE
- DATE (система дат 1900)
- DAYS
- FIND
- FINDB
- IF
- INDEX (форма ссылки)
- LOOKUP (векторная форма)
- MATCH (векторная форма)
- MAX
- SUM
- VLOOKUP

## **FAQ**

**Поддерживаются ли внешние файлы Excel в качестве источника данных для диаграммы с формулами?**

Да. Aspose.Slides поддерживает внешние книги как [источник данных диаграммы](https://reference.aspose.com/slides/net/aspose.slides.charts/chartdatasourcetype/), что позволяет использовать формулы из XLSX вне презентации.

**Могут ли формулы диаграммы ссылаться на листы в той же книге по имени листа?**

Да. Формулы следуют стандартной модели ссылок Excel, поэтому вы можете ссылаться на другие листы в той же книге или во внешней книге. Для внешних ссылок указывайте путь и имя книги, используя синтаксис Excel.