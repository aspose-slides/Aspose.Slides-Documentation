---
title: Применение формул листов диаграмм в презентациях на .NET
linktitle: Формулы листов
type: docs
weight: 70
url: /ru/net/chart-worksheet-formulas/
keywords:
- лист диаграммы
- рабочий лист диаграммы
- формула диаграммы
- формула листа
- формула таблицы
- источник данных
- логическая константа
- числовая константа
- строковая константа
- константа ошибки
- арифметическая константа
- оператор сравнения
- стиль A1
- стиль R1C1
- предопределённая функция
- PowerPoint
- презентация
- .NET
- C#
- Aspose.Slides
description: "Применяйте формулы в стиле Excel в Aspose.Slides для листов диаграмм .NET и автоматизируйте отчёты в файлах PPT и PPTX."
---

## **О формуле листа диаграммы в презентации**
**Лист диаграммы** (или лист рабочего листа) в презентации является источником данных диаграммы. Лист диаграммы содержит данные, которые отображаются на диаграмме графически. При создании диаграммы в PowerPoint автоматически создаётся также лист, связанный с этой диаграммой. Лист создаётся для всех типов диаграмм: линейные, столбчатые, sunburst, круговые и т.д. Чтобы увидеть лист диаграммы в PowerPoint, дважды щёлкните по диаграмме:

![todo:image_alt_text](chart-worksheet-formulas_1.png)

Лист диаграммы содержит имена элементов диаграммы (Category Name: *Category1*, Serie Name) и таблицу с числовыми данными, соответствующими этим категориям и сериям. По умолчанию, при создании новой диаграммы данные листа заполняются стандартными значениями. Затем вы можете изменить данные листа вручную.

Обычно диаграмма представляет сложные данные (например, финансовые аналитики, научные аналитики), имея ячейки, рассчитываемые из значений других ячеек или из динамических данных. Ручной ввод значения ячейки и его фиксирование усложняет последующие изменения. Если изменить значение конкретной ячейки, все зависящие от неё ячейки также потребуют обновления. Более того, данные таблицы могут зависеть от данных других таблиц, формируя сложную схему данных презентации, которую нужно легко и гибко обновлять.

**Формула листа диаграммы** в презентации — это выражение для автоматического расчёта и обновления данных листа диаграммы. Формула листа определяет логику вычисления данных для определённой ячейки или набора ячеек. Формула листа — это математическая или логическая формула, использующая ссылки на ячейки, математические функции, логические операторы, арифметические операторы, функции преобразования, строковые константы и т.д. Определение формулы записывается в ячейку, и эта ячейка не содержит простого значения. Формула вычисляет значение и возвращает его, после чего значение присваивается ячейке. Формулы листа диаграмм в презентациях фактически такие же, как формулы Excel, и поддерживают те же стандартные функции, операторы и константы.

В [**Aspose.Slides**](https://products.aspose.com/slides/net/) лист диаграммы представлен свойством 
[**Chart.ChartData.ChartDataWorkbook**](https://reference.aspose.com/slides/net/aspose.slides.charts/ichartdata/properties/chartdataworkbook) типа 
[**IChartDataWorkbook**](https://reference.aspose.com/slides/net/aspose.slides.charts/ichartdataworkbook). 
Формула листа может быть назначена и изменена с помощью свойства 
[**IChartDataCell.Formula**](https://reference.aspose.com/slides/net/aspose.slides.charts/ichartdatacell/properties/formula). 
Поддерживается следующая функциональность формул в Aspose.Slides:

- Логические константы
- Числовые константы
- Строковые константы
- Константы ошибок
- Арифметические операторы
- Операторы сравнения
- Ссылки на ячейки в стиле A1
- Ссылки на ячейки в стиле R1C1
- Предопределённые функции

Обычно листы хранят последние вычисленные значения формул. Если после загрузки презентации данные диаграммы не изменялись, свойство **IChartDataCell.Value** возвращает эти значения при чтении. Но если данные листа были изменены, при чтении свойства **ChartDataCell.Value** генерируется **CellUnsupportedDataException** для формул, которые не поддерживаются. Это происходит, потому что при успешном разборе формул определяются зависимости ячеек и проверяется корректность последних значений. Если формула не может быть разобрана, корректность значения ячейки гарантировать нельзя.

## **Добавить формулу листа диаграммы в презентацию**
Сначала добавьте диаграмму с образцовыми данными на первый слайд новой презентации с помощью 
[IShapeCollection.Shapes.AddChart](https://reference.aspose.com/slides/net/aspose.slides.ishapecollection/addchart/methods/1). 
Лист диаграммы создаётся автоматически и доступен через свойство 
[**Chart.ChartData.ChartDataWorkbook**](https://reference.aspose.com/slides/net/aspose.slides.charts/ichartdata/properties/chartdataworkbook):
``` csharp
using (var presentation = new Presentation())
{
    IChart chart = presentation.Slides[0].Shapes.AddChart(ChartType.ClusteredColumn, 150, 150, 500, 300);
    IChartDataWorkbook workbook = chart.ChartData.ChartDataWorkbook;
    // ...
}
```


Запишем некоторые значения в ячейки с помощью свойства 
[**IChartDataCell.Value**](https://reference.aspose.com/slides/net/aspose.slides.charts/ichartdatacell/properties/value) типа **Object**, что позволяет установить любое значение:
``` csharp

workbook.GetCell(0, "F2").Value = -2.5;

workbook.GetCell(0, "G3").Value = 6.3;

workbook.GetCell(0, "H4").Value = 3;

```


Чтобы записать формулу в ячейку, используйте свойство 
[**IChartDataCell.Formula**](https://reference.aspose.com/slides/net/aspose.slides.charts/ichartdatacell/properties/formula):
``` csharp
workbook.GetCell(0, "B2").Formula = "F2+G3+H4+1";
```


*Note*: Свойство [**IChartDataCell.Formula**](https://reference.aspose.com/slides/net/aspose.slides.charts/ichartdatacell/properties/formula) используется для установки ссылок на ячейки в стиле A1.

Чтобы установить ссылку на ячейку в стиле [R1C1Formula](https://reference.aspose.com/slides/net/aspose.slides.charts/ichartdatacell/properties/r1c1formula), используйте свойство [**IChartDataCell.R1C1Formula**](https://reference.aspose.com/slides/net/aspose.slides.charts/ichartdatacell/properties/r1c1formula):
``` csharp
workbook.GetCell(0, "C2").R1C1Formula = "R[1]C[4]/R[2]C[5]";
```


Затем вызовите метод [**IChartDataWorkbook.CalculateFormulas**](https://reference.aspose.com/slides/net/aspose.slides.charts/chartdataworkbook/methods/calculateformulas) для вычисления всех формул в рабочей книге и обновления соответствующих значений ячеек:
``` csharp
workbook.CalculateFormulas();

object value1 = workbook.GetCell(0, "B2"); // 7.8

object value2 = workbook.GetCell(0, "C2"); // 2.1

```


## **Логические константы**
Вы можете использовать логические константы, такие как *FALSE* и *TRUE*, в формулах ячеек:

## **Числовые константы**
Числа могут использоваться в обычной или научной нотации для создания формул листа диаграммы:

## **Строковые константы**
Строковая (или буквальная) константа — это конкретное значение, которое используется как есть и не меняется. Строковые константы могут быть: даты, тексты, числа и т.д.:

## **Константы ошибок**
Иногда результат формулы вычислить невозможно. В этом случае в ячейке отображается код ошибки вместо её значения. Каждый тип ошибки имеет свой код:

- #DIV/0! - формула пытается делить на ноль.
- #GETTING_DATA - может отображаться в ячейке, пока её значение ещё рассчитывается.
- #N/A - информация отсутствует или недоступна. Причины могут быть: пустые ячейки, лишний пробел, опечатка и т.п.
- #NAME? - определённая ячейка или другой объект формулы не найден по имени.
- #NULL! - может появиться при ошибке в формуле, например:  (,) или пробел вместо двоеточия (:).
- #NUM! - числовой аргумент в формуле недопустим, слишком большой или маленький.
- #REF! - неверная ссылка на ячейку.
- #VALUE! - неожиданный тип значения. Например, строковое значение в числовой ячейке.

## **Арифметические операторы**
Вы можете использовать все арифметические операторы в формулах листа диаграммы:

|**Оператор**|**Значение**|**Пример**|
| :- | :- | :- |
|+ (знак плюс)|Сложение или унарный плюс|2 + 3|
|- (знак минус)|Вычитание или отрицание|2 - 3<br>-3|
|* (звёздочка)|Умножение|2 * 3|
|/ (слеш)|Деление|2 / 3|
|% (процент)|Процент|30%|
|^ (кэрет)|Возведение в степень|2 ^ 3|

*Note*: Чтобы изменить порядок вычисления, заключите часть формулы, которую нужно вычислить первой, в скобки.

## **Операторы сравнения**
Вы можете сравнивать значения ячеек с помощью операторов сравнения. При сравнении двух значений с использованием этих операторов результатом будет логическое значение *TRUE* или FALSE:

|**Оператор**|**Значение**|**Значение**|
| :- | :- | :- |
|= (равно)|Равно|A2 = 3|
|<> (не равно)|Не равно|A2 <> 3|
|> (больше чем)|Больше чем|A2 > 3|
|>= (больше или равно)|Больше или равно|A2 >= 3|
|< (меньше чем)|Меньше чем|A2 < 3|
|<= (меньше или равно)|Меньше или равно|A2 <= 3|

## **Ссылки на ячейки в стиле A1**
**Ссылки на ячейки в стиле A1** используются для листов, где столбец имеет буквенный идентификатор (например, "*A*"), а строка — числовой (например, "*1*"). Ссылки в стиле A1 могут использоваться следующим образом:

|**Ссылка**|**Пример**|||
| :- | :- | :- | :- |
||Абсолютная|Относительная|Смешанная|
|Ячейка|$A$2|A2|<p>A$2</p><p>$A2</p>|
|Строка|$2:$2|2:2|-|
|Столбец|$A:$A|A:A|-|
|Диапазон|$A$2:$C$4|A2:C4|<p>$A$2:C4</p><p>A$2:$C4</p>|

Вот пример, как использовать ссылку в стиле A1 в формуле:

## **Ссылки на ячейки в стиле R1C1**
**Ссылки на ячейки в стиле R1C1** используются для листов, где и строка, и столбец имеют числовой идентификатор. Ссылки в стиле R1C1 могут использоваться следующим образом:

|**Ссылка**|**Пример**|||
| :- | :- | :- | :- |
||Абсолютная|Относительная|Смешанная|
|Ячейка|R2C3|R[2]C[3]|R2C[3]<br>R[2]C3|
|Строка|R2|R[2]|-|
|Столбец|C3|C[3]|-|
|Диапазон|R2C3:R5C7|R[2]C[3]:R[5]C[7]|R2C3:R[5]C[7]<br>R[2]C3:R5C[7]|

Вот пример, как использовать ссылку в стиле A1 в формуле:

## **Предопределённые функции**
Существуют предопределённые функции, которые могут использоваться в формулах для упрощения их реализации. Эти функции инкапсулируют наиболее часто используемые операции, такие как:

- ABS
- AVERAGE
- CEILING
- CHOOSE
- CONCAT
- CONCATENATE
- DATE (система дат 1900)
- DAYS
- FIND
- FINDB
- IF
- INDEX (форма ссылки)
- LOOKUP (векторная форма)
- MATCH (векторная форма)
- MAX
- SUM
- VLOOKUP

## **FAQ**

**Поддерживаются ли внешние файлы Excel в качестве источника данных для диаграммы с формулами?**

Да. Aspose.Slides поддерживает внешние книги как [источник данных диаграммы](https://reference.aspose.com/slides/net/aspose.slides.charts/chartdatasourcetype/), что позволяет использовать формулы из XLSX вне презентации.

**Могут ли формулы диаграммы ссылаться на листы в той же книге по имени листа?**

Да. Формулы следуют стандартной модели ссылок Excel, поэтому вы можете ссылаться на другие листы в той же книге или во внешней книге. Для внешних ссылок указывайте путь и имя книги, используя синтаксис Excel.